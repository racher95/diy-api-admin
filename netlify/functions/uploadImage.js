import { writeFile, owner, repo } from "./_shared.mjs";
export async function handler(event){try{if(event.httpMethod!=="POST")return{statusCode:405,body:"Method Not Allowed"};const {folder="images/products",filename,dataUrl}=JSON.parse(event.body||"{}");if(!filename||!dataUrl)return{statusCode:400,body:"filename and dataUrl are required"};const base64=(dataUrl.includes(",")?dataUrl.split(",")[1]:dataUrl);const path=`${folder}/${filename}`;await writeFile(path,base64,`UPLOAD image ${path}`);const publicUrl=`https://${owner}.github.io/${repo}/${path}`;return{statusCode:200,headers:{"Content-Type":"application/json"},body:JSON.stringify({ok:true,url:publicUrl,path})};}catch(e){return{statusCode:500,body:String(e)}}}